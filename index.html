<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>睡眠進度條</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f5f5f5;
    }

    .bar-container {
      display: flex;
      justify-content: space-between;
      width: 90vw;
      max-width: 600px;
      height: 30px;
      margin-top: 50px;
      gap: 5px;
    }

    .bar {
      flex: 1;
      background-color: #ccc;
      border-radius: 5px;
      transition: background-color 0.5s;
      position: relative;
    }

    .bar.active.yellow {
      background-color: #ffd54f;
    }

    .bar.active.red {
      background-color: #e57373;
    }

    .bar.warning {
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }

    .countdown {
      margin-top: 20px;
      font-size: 1.5em;
      display: none;
    }

    .toggle-btn, .reset-btn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      background-color: #666;
      color: white;
      cursor: pointer;
    }

    .reset-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      background-color: #d32f2f;
    }

    .message {
      margin-top: 20px;
      font-weight: bold;
      color: #d32f2f;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="bar-container" id="barContainer"></div>
  <div class="countdown" id="countdown"></div>
  <button class="toggle-btn" id="toggleBtn">顯示倒數時間</button>
  <div class="message" id="finalMessage"></div>
  <button class="reset-btn" id="resetBtn">重置</button>

  <script>
    const barCount = 6;
    const duration = 1 * 60; // 5 分鐘 = 300 秒
    const intervalPerBar = duration / barCount;
    const barContainer = document.getElementById('barContainer');
    const countdown = document.getElementById('countdown');
    const toggleBtn = document.getElementById('toggleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const finalMessage = document.getElementById('finalMessage');

    let currentTime = duration;
    let timer;
    let showCountdown = false;

    // 建立進度條
    function createBars() {
      barContainer.innerHTML = '';
      for (let i = 0; i < barCount; i++) {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        barContainer.appendChild(bar);
      }
    }

    // 更新進度條與倒數時間
    function updateProgress() {
      const bars = document.querySelectorAll('.bar');
      const activeBars = Math.ceil(currentTime / intervalPerBar);

      bars.forEach((bar, index) => {
        bar.className = 'bar';
        if (index < activeBars) {
          bar.classList.add('active');
          if (activeBars <= 3) {
            bar.classList.add('red');
          } else if (activeBars <= 6) {
            bar.classList.add('yellow');
          }
        }

        // 最後一格閃爍 + 顯示數字
        if (index === activeBars - 1) {
          bar.classList.add('warning');
          if (activeBars === 1) {
            bar.textContent = `${currentTime}s`;
          } else {
            bar.textContent = '';
          }
        } else {
          bar.textContent = '';
        }
      });

      // 倒數時間顯示
      if (showCountdown) {
        countdown.style.display = 'block';
        const minutes = Math.floor(currentTime / 60);
        const seconds = currentTime % 60;
        countdown.textContent = `剩下 ${minutes}:${seconds.toString().padStart(2, '0')}`;
      } else {
        countdown.style.display = 'none';
      }

      // 最後提示
      if (currentTime === 0) {
        finalMessage.textContent = '手機使用超時，檯燈關閉，將立即鎖機30分鐘';
      } else {
        finalMessage.textContent = '';
      }
    }

    // 啟動計時
    function startCountdown() {
      clearInterval(timer);
      timer = setInterval(() => {
        currentTime--;
        updateProgress();
        if (currentTime <= 0) {
          clearInterval(timer);
        }
      }, 1000);
    }

    // 重置所有內容
    function resetAll() {
      clearInterval(timer);
      currentTime = duration;
      createBars();
      updateProgress();
      startCountdown();
    }

    // 初始化
    createBars();
    updateProgress();
    startCountdown();

    // 切換倒數時間顯示
    toggleBtn.addEventListener('click', () => {
      showCountdown = !showCountdown;
      toggleBtn.textContent = showCountdown ? '隱藏倒數時間' : '顯示倒數時間';
      updateProgress();
    });

    // 重置按鈕
    resetBtn.addEventListener('click', resetAll);
  </script>
</body>
</html>

